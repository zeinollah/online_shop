from django.db import modelsfrom django.utils.translation import gettext_lazy as _import uuidfrom datetime import datetimefrom customers.models import CustomerProfilefrom products.models import Productclass Order(models.Model):    ORDER_STATUS_CHOICES = (        ('pending', 'Pending'),        ('paid', 'Paid'),        ('processing', 'Processing'),        ('shipped', 'Shipped'),        ('delivered', 'Delivered'),        ('cancelled', 'Cancelled'),    )    PAYMENT_STATUS_CHOICES = (        ('cash', 'Cash'),        ('wallet', 'Wallet'),        ('credit card', 'Credit Card'),    )    customer = models.ForeignKey(CustomerProfile, on_delete=models.CASCADE, related_name='orders')    order_number = models.CharField(_('Order Number'), max_length=30, unique=True, editable=False)    order_status = models.CharField(_('Order Status'), max_length=30, choices=ORDER_STATUS_CHOICES, default='pending')    shipping_city = models.CharField(_('Shipping City'), max_length=30)    shipping_address = models.CharField(_('Shipping Address'), max_length=100)    shipping_post_code = models.CharField(_('Shipping Post Code'), max_length=30)    shipping_phone = models.CharField(_('Shipping Phone'), max_length=11)    total_price = models.DecimalField(_('Total Price'), max_digits=10, decimal_places=3)    payment_method = models.CharField(_('Payment Method'), max_length=30, choices=PAYMENT_STATUS_CHOICES)    is_paid = models.BooleanField(_('Is Paid'), default=False)    paid_at = models.DateTimeField(_('Paid At'), null=True, blank=True)    created_at = models.DateTimeField(_('Created'), auto_now_add=True)    updated_at = models.DateTimeField(_('Updated At'), auto_now=True)    def calculate_total(self):        """Calculate total price for items in order and save in DB"""        self.total_price = sum(item.subtotal for item in self.order_items.all())        self.save()    def save(self, *args, **kwargs):        """        This function create unique order number automatically        in this format [ORD-20251201-C4A8E7B2F3],        use date and uuid.        """        if not self.order_number:            str_date = datetime.now().strftime('%Y%m%d')            unique_number = uuid.uuid4().hex[:10].upper()            self.order_number = f"ORD-{str_date}-{unique_number}"        super().save(*args, **kwargs)    def __str__(self):        return f"{self.customer} - {self.order_number} - Total Price = {self.total_price}"    class Meta:        ordering = ['-created_at']class OrderItem(models.Model):    order = models.ForeignKey(Order, on_delete=models.CASCADE, related_name='order_items')    product = models.ForeignKey(Product, on_delete=models.CASCADE, related_name='order_items')    product_name = models.CharField(_('Product Name'), max_length=100)    quantity = models.PositiveIntegerField(default=1)    price = models.DecimalField(_('Price'), max_digits=10, decimal_places=3)    discount = models.DecimalField(_('Discount'), max_digits=10, decimal_places=3, default=0)    created_at = models.DateTimeField(_('Created'), auto_now_add=True)    updated_at = models.DateTimeField(_('Updated At'), auto_now=True)    @property    def subtotal(self):        """Calculate subtotal for item"""        return (self.price * self.quantity) - self.discount    def save(self, *args, **kwargs):        """set price for product if it's not set"""        if not self.price:            self.price = self.product.price        super().save(*args, **kwargs)    def __str__(self):        return f"{self.product} - {self.quantity} - {self.price}"    class Meta:        ordering = ['-created_at']